# 新現場写真アプリ2 詳細仕様書

## プロジェクト概要

### プロジェクト名
新現場写真管理システム (GenbaPhoto Desktop)

### 目的
現行の現場写真一括印刷アプリ（v1.36）の問題点を解決し、建設現場の写真管理業務を効率化する次世代**完全オフライン対応デスクトップアプリケーション**を開発する。

### ターゲットユーザー
- 建設現場監督・技術者
- 工事写真管理担当者
- 品質管理・安全管理担当者
- 現場作業員

## システム要件

### 技術スタック

#### デスクトップアプリケーション
- **フレームワーク**: Electron
- **フロントエンド**: Vue.js 3 (Composition API)
- **UI ライブラリ**: Tailwind CSS + HeadlessUI
- **状態管理**: Pinia
- **ビルドツール**: Vite + Electron Builder
- **データベース**: SQLite（完全ローカル）

#### ネイティブ機能
- **ファイルシステム**: Node.js fs API
- **画像処理**: Sharp (Node.js)
- **PDF生成**: Puppeteer / jsPDF
- **印刷**: Electron Print API
- **OS統合**: Electron Main Process API

#### 開発・ビルド
- **言語**: TypeScript
- **テスト**: Vitest + Vue Testing Library + Spectron
- **リンター**: ESLint + Prettier
- **パッケージマネージャー**: pnpm
- **インストーラー**: NSIS (Windows) / DMG (macOS)

### 動作環境
- **OS**: Windows 10/11 (主要), macOS 10.15+, Linux (Ubuntu 20.04+)
- **アーキテクチャ**: x64, ARM64
- **メモリ**: 4GB RAM以上推奨
- **ストレージ**: 2GB以上の空き容量
- ****完全オフライン動作**: インターネット接続不要

### システム統合
- **ファイルエクスプローラー連携**: 右クリックメニュー統合
- **プリンター直接連携**: システムプリンター設定利用
- **ローカルネットワーク**: 同一LAN内でのデータ共有機能
- **外部デバイス**: USBカメラ、スキャナー連携対応

## 機能仕様

### 1. 写真管理機能

#### 1.1 写真インポート
**基本機能**
- ドラッグ&ドロップ対応（エクスプローラーから直接）
- フォルダ一括取り込み（サブフォルダ含む）
- USBデバイス自動認識・取り込み
- デジタルカメラ直接取り込み（PTP/MTP対応）

**制限事項**
- 対応形式: JPEG, PNG, TIFF, WebP, HEIC, RAW（主要形式）
- ファイルサイズ: 制限なし（ディスク容量による）
- 同時取り込み: 無制限（メモリ許容範囲内）
- 総容量制限: ディスク容量による（数TB対応可能）

**画質・変換設定**
- 元画像保持 + 表示用サムネイル自動生成
- RAW現像機能（基本的な露出・コントラスト調整）
- HEIC → JPEG自動変換オプション
- メタデータ完全保持（EXIF, IPTC, XMP）

#### 1.2 写真情報管理
**メタデータ**
- EXIF情報完全読み取り・表示
- GPS情報（緯度経度 + 住所逆引き機能）
- 撮影機器情報（カメラ・レンズ・設定値）
- ファイルシステム情報（作成日・更新日・サイズ）

**分類・検索**
- 階層フォルダ管理（無制限階層）
- カスタムタグシステム（色分け・アイコン対応）
- 全文検索（メタデータ・コメント・ファイル名）
- 類似画像検索（ハッシュベース）
- 重複画像検出・統合機能

#### 1.3 画像編集・加工
**非破壊編集**
- 元画像保持 + 編集情報別保存
- 回転・反転（90度単位・自由角度）
- トリミング（比率固定・自由形状）
- 露出・コントラスト・彩度調整

**注釈・マーキング機能**
- テキスト注釈（フォント・サイズ・色自由設定）
- 図形描画（矢印・円・四角・自由線）
- 寸法測定（ピクセル・実寸法変換）
- エリア・角度測定
- レイヤー管理（表示・非表示切り替え）

### 2. レイアウト・印刷機能

#### 2.1 印刷レイアウト設計
**ページ設定**
- 用紙サイズ: A4, A3, B4, B5, Letter, Legal + カスタムサイズ
- 向き: 縦・横（写真ごとに自動判定も可能）
- 余白: ミリ単位での精密設定
- 印刷品質: Draft, Normal, High, Maximum

**レイアウトエンジン**
- WYSIWYG（見たまま印刷）プレビュー
- 自由配置レイアウト（ピクセル単位調整）
- グリッドスナップ機能
- テンプレート保存・読み込み
- 複数ページ対応（ページネーション自動調整）

#### 2.2 テキスト・情報表示
**ヘッダー・フッター**
- 工事情報テンプレート（プロジェクト別保存）
- 自動ページ番号・総ページ数
- 印刷日時自動挿入
- 会社ロゴ・印影画像対応

**写真情報表示**
- 撮影日時（和暦・西暦・24時間・12時間形式選択）
- 撮影場所・工種（プルダウン選択 + 自由入力）
- 承認印・検印欄（画像貼り付け対応）
- QRコード生成（写真ID・プロジェクト情報）

#### 2.3 印刷・エクスポート
**ネイティブ印刷**
- システムプリンター直接連携
- プリンタープロファイル対応（色補正）
- バッチ印刷（複数レイアウト一括出力）
- 印刷履歴・再印刷機能

**エクスポート機能**
- 高解像度PDF出力（埋め込みフォント対応）
- Microsoft Office連携（Word, Excel, PowerPoint）
- 画像エクスポート（PNG, JPEG, TIFF）
- アーカイブ出力（ZIP, 7z）

### 3. データ管理機能

#### 3.1 プロジェクト・ファイル管理
**プロジェクト構造**
- プロジェクトファイル形式（.gbp拡張子）
- 階層フォルダ管理（エクスプローラー風UI）
- プロジェクト間でのデータコピー・移動
- テンプレートプロジェクト機能

**ファイル管理**
- 相対パス・絶対パス切り替え
- リンク切れ検出・修復機能
- ファイル移動追跡（自動リンク更新）
- 外部ストレージ対応（USB, ネットワークドライブ）

#### 3.2 バックアップ・データ保護
**自動バックアップ**
- 定期自動バックアップ（時間・日・週単位）
- インクリメンタルバックアップ
- 世代管理（指定数保持・古いバックアップ自動削除）
- 復元ポイント作成・復元機能

**データ整合性**
- データベース整合性チェック
- ファイル破損検出・修復
- 操作履歴・ログ機能
- 緊急復旧モード

#### 3.3 インポート・エクスポート・互換性
**データ移行**
- 既存v1.36からの完全移行ツール
- 他社製品からのデータ取り込み
- CSVインポート・エクスポート
- データベースダンプ・復元

**標準フォーマット対応**
- CALS（建設分野標準）
- SXF（建設CAD標準）
- IFC（BIMデータ交換標準）
- 国土交通省電子納品要領準拠

### 4. ユーザーインターフェース

#### 4.1 デスクトップネイティブUI
**ウィンドウ管理**
- マルチウィンドウ対応（プロジェクト別）
- ドッキング・フローティングパネル
- ワークスペース保存・復元
- マルチモニター対応（ウィンドウ配置記憶）

**操作性**
- 完全キーボードショートカット対応
- マウスジェスチャー機能
- コンテキストメニュー（右クリック）
- ドラッグ&ドロップ操作全面対応

#### 4.2 高度なデスクトップ機能
**ファイルシステム統合**
- エクスプローラー右クリックメニュー追加
- ファイル関連付け（.jpg等をアプリで開く）
- サムネイル生成（エクスプローラープレビュー対応）
- ジャンプリスト対応（Windows）

**システム統合**
- 通知システム連携
- タスクトレイ常駐機能
- 自動起動設定
- Windows Services連携（バックアップ等）

#### 4.3 パフォーマンス・応答性
**高速レンダリング**
- ハードウェアアクセラレーション利用
- 仮想スクロール（大量画像対応）
- 段階的ロード（サムネイル → 高解像度）
- マルチスレッド画像処理

### 5. セキュリティ・信頼性

#### 5.1 データセキュリティ
**ローカルデータ保護**
- データベース暗号化（AES-256）
- ファイル暗号化オプション
- アクセス権限管理（Windows ACL連携）
- セキュアデリート（完全削除）

**操作制御**
- ユーザー認証（ローカル・Active Directory連携）
- 操作ログ記録・監査
- データアクセス制御
- バックアップ暗号化

#### 5.2 システム信頼性
**安定性**
- メモリリーク対策
- 例外処理・エラー回復
- 自動保存・復旧機能
- クラッシュレポート・診断機能

**パフォーマンス監視**
- リソース使用量監視
- 処理速度最適化
- メモリ効率化
- ディスク容量管理

## 非機能要件

### パフォーマンス
- **起動時間**: 5秒以内（通常起動）、2秒以内（2回目以降）
- **レスポンス時間**: UI操作50ms以内
- **画像表示**: サムネイル100ms以内、フル画像1秒以内
- **印刷処理**: A4 6枚レイアウト 30秒以内

### 拡張性・保守性
- **プラグインアーキテクチャ**: サードパーティ拡張対応
- **API提供**: COM/DLL形式での外部連携
- **設定外部化**: JSON設定ファイル + UI設定画面
- **ログ・診断**: 詳細ログ出力 + リモート診断対応

### 互換性・移植性
- **OS互換性**: Windows 10/11完全対応、macOS/Linux基本対応
- **データポータビリティ**: プロジェクトファイル完全移植可能
- **外部デバイス**: 主要デジカメ・スキャナー対応
- **印刷機器**: 業務用大判プリンター対応

### セキュリティ・コンプライアンス
- **個人情報保護**: GDPR・個人情報保護法準拠
- **建設業界標準**: 電子納品要領対応
- **企業セキュリティ**: ウイルススキャナー連携、企業ポリシー対応

## 開発・デプロイ計画

### Phase 1: 基盤開発（4ヶ月）
**目標**: 基本的なデスクトップアプリ機能の実装
- Electronアプリケーション基盤構築
- SQLiteデータベース設計・実装
- 写真取り込み・表示・基本編集機能
- 印刷・レイアウト基本機能

### Phase 2: 高度機能（3ヶ月）
**目標**: 専門機能・システム統合の実装
- 高度な画像編集・注釈機能
- プロジェクト管理・バックアップ機能
- OS統合・エクスプローラー連携
- データインポート・エクスポート機能

### Phase 3: 最適化・テスト（2ヶ月）
**目標**: パフォーマンス最適化・品質保証
- パフォーマンス最適化・メモリ効率化
- ユーザビリティテスト・フィードバック反映
- セキュリティ監査・脆弱性対策
- インストーラー・配布パッケージ作成

### Phase 4: 運用・保守（継続）
**目標**: 継続的改善・サポート
- 自動更新システム構築
- ユーザーサポート・バグ修正
- 新機能開発・拡張
- 長期保守・セキュリティ更新

## 配布・ライセンス戦略

### 配布形態
- **スタンドアロン**: 完全オフライン動作（インストーラー配布）
- **ポータブル版**: USBメモリから直接実行可能
- **企業版**: Active Directory連携・一括配布対応
- **ライセンス認証**: オフライン認証システム（ハードウェアフィンガープリント）

### サポート体制
- **マニュアル**: 詳細操作マニュアル・FAQ
- **トレーニング**: オンサイト・リモート研修対応
- **技術サポート**: 電話・メール・リモート支援
- **コミュニティ**: ユーザーフォーラム・ナレッジベース

## リスク管理

### 技術的リスク
**Electronパフォーマンス**
- リスク: Electronアプリの重さ・メモリ使用量
- 対策: ネイティブモジュール活用・プロセス分離・メモリ最適化

**クロスプラットフォーム対応**
- リスク: OS固有機能の実装差異
- 対策: 段階的対応・OS別テスト環境構築

**データ移行**
- リスク: 既存アプリからの移行失敗
- 対策: 完全移行ツール・段階移行・データ検証機能

## 成功指標（KPI）

### 技術指標
- アプリ起動時間: 3秒以内
- メモリ使用量: 通常使用時500MB以下
- エラー発生率: 0.1%以下
- データ損失率: 0%

### 事業指標
- 既存ユーザー移行率: 90%（12ヶ月以内）
- 作業効率向上: 40%削減
- サポート問い合わせ: 60%削減
- ユーザー満足度: 4.7/5以上

## まとめ

本デスクトップアプリケーション版新現場写真アプリは、**完全オフライン動作**を前提とした企業・現場環境に最適化された堅牢なソリューションです。

Web版では難しいOS深部統合、高速なローカル処理、無制限のストレージ活用により、建設現場の厳しい要求に応える高性能・高信頼性アプリケーションとして設計されています。

段階的開発により確実な品質を確保し、長期間の安定運用と継続的な機能拡張を支援する持続可能なデスクトップソリューションを提供します。

---

**文書バージョン**: 2.0
**作成日**: 2025年9月8日
**作成者**: Claude (Anthropic)
**対象**: デスクトップアプリケーション版
**前提条件**: 完全オフライン動作環境